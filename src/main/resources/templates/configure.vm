<head>
    <meta name="decorator" content="atl.admin"/>
    <title>$i18n.getText("saml2plugin.admin.title")</title>
    <meta name="admin.active.section" content="admin_system_menu/top_system_section/mail_section">
    <meta name="admin.active.tab" content="saml2plugin.config.link">
    $webResourceManager.requireResource("com.bitium.jira.SAML2PluginJira:admin-resources")
</head>
<body>

    #if ($success == "success")
    <div class="aui-message closeable shadowed info">
        <p>$textutils.htmlEncode($i18n.getText("saml2plugin.admin.message.saved"))</p>
    </div>
    #elseif (${hasErrorMessages})
    <div class="aui-message closeable error">
        #foreach ( $error in $action.getErrorMessages() )
            <p>$textutils.htmlEncode( $error )</p>
        #end
    </div>
    #end
<form class="aui" name="saml2pluginjira-configure-form" method="POST"
      action="${req.contextPath}/secure/admin/saml2pluginjira.configure.jspa">

    <input type="hidden" name="submitAction" value="submit"/>

    #set($urlPrefix = "http://")
    #if ($req.secure)
        #set($urlPrefix = "https://")
    #end

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.samlEndpoint")</div>
    <div>
        <input class="field-input" id="samlEndpoint" type="text" disabled="disabled"
               value="$urlPrefix${req.serverName}:${req.serverPort}${req.contextPath}/plugins/servlet/saml/auth">
        <input class="aui-button aui-button-primary" id="copy-button" value="Copy"
               style="font-size:12px;margin-left:-65px;width:55px;padding-bottom:2px;"/>
            <span id="endpoint-copied"
                  style="visibility:hidden;color:grey;font-size:12px;margin-left:10px;">$i18n.getText(
                "saml2plugin.admin.endpoint-copied")</span>
    </div>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.samlEndpoint.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.spEntityId")</div>
    <input class="field-input" type="text" name="spEntityId" id="spEntityId"
           value="$spEntityId"/>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.spEntityId.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.metadata")</div>
    <input class="field-input" type="text" name="metadata" id="metadata"
           value="$metadata"/>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.metadata.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.keystore")</div>
    <input class="field-input" type="text" name="keystore" id="keystore"
           value="$keystore"/>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.keystore.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.keystorePassword")</div>
    <input class="field-input" type="text" name="keystorePassword" id="keystorePassword"
           value="$keystorePassword"/>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.keystorePassword.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.signKey")</div>
    <input class="field-input" type="text" name="signKey" id="signKey"
           value="$signKey"/>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.signKey.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.redirectUrl")</div>
    <input class="field-input" type="text" name="redirectUrl" id="redirectUrl"
           value="$textutils.htmlEncode( $redirectUrl )"/>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.redirectUrl.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.baseUrl")</div>
    <input class="field-input" type="text" name="baseUrl" id="baseUrl"
           value="$textutils.htmlEncode( $baseUrl )"/>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.baseUrl.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.uidAttribute")</div>
    <input class="field-input" type="text" name="uidAttribute" id="uidAttribute"
           value="$textutils.htmlEncode($uidAttribute)"/>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.uidAttribute.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.platformUidAttribute")</div>
    <select class="field-select" name="platformUidAttribute" id="platformUidAttribute">
        #foreach( $attribute in $availablePlatformUidAttributes )
        <option value="$attribute"
                #if ($platformUidAttribute.equals($attribute))
                selected
                #end>$attribute.toLowerCase()</option>
        #end
    </select>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.platformUidAttribute.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.maxAuthenticationAge")</div>
    <input class="field-input" type="text" name="maxAuthenticationAge" id="maxAuthenticationAge"
           value="$maxAuthenticationAge"/>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.maxAuthenticationAge.desc")</div>

    <div class="field-label">
        <input type="checkbox" name="idpRequired" id="idpRequired" class="checkbox"
            #if ($idpRequired.equals("true"))
               checked
            #end>$i18n.getText("saml2plugin.admin.field.idpRequired")
    </div>
    <div class="field-desc field-desc-checkbox">$i18n.getText("saml2plugin.admin.field.idpRequired.desc")</div>

    <div class="field-label">
        <input type="checkbox" name="autoCreateUser" id="autoCreateUser" class="checkbox"
               #if ($autoCreateUser.equals("true"))
        checked
        #end>$i18n.getText("saml2plugin.admin.field.autoCreateUser")
    </div>
    <div class="field-desc field-desc-checkbox">$i18n.getText("saml2plugin.admin.field.autoCreateUser.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.autoCreateUserDefaultGroup")</div>
    <select class="field-select" name="defaultAutoCreateUserGroup" id="defaultAutoCreateUserGroup">
        #foreach( $group in $existingGroups )
            <option value="$group"
                #if ($defaultAutoCreateUserGroup.equals($group))
                    selected
                #end>$group</option>
        #end
    </select>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.autoCreateUserDefaultGroup.desc")</div>

    <div class="field-label">$i18n.getText("saml2plugin.admin.field.requestBinding")</div>
    <select class="field-select" name="requestBinding" id="requestBinding">
        #foreach( $binding in $existingBinding )
        <option value="$binding"
                #if ($requestBinding.equals($binding))
                selected
                #end>$binding</option>
        #end
    </select>
    <div class="field-desc">$i18n.getText("saml2plugin.admin.field.requestBinding.desc")</div>

    <div style="margin-top:10px"><input class="aui-button aui-button-primary" type="submit" value="$i18n.getText('save.name')">
    </div>

</form>
</body>
</html>
